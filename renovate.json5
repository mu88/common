{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "github>mu88/common//renovate/default.json5"
  ],
  "devcontainer": {
    "managerFilePatterns": [
      "/^devcontainers\\/\\S+\\/devcontainer\\.json$/"
    ]
  },
  "packageRules": [
    {
      "description": "Non-major updates of .NET SDK can be integrated into dev containers immediately after the release, because these dev containers won't be immediately used by downstream repositories, i.e. it's safe to already have them.",
      "matchUpdateTypes": [
        "minor",
        "patch"
      ],
      "matchPackageNames": [
        "dotnet-sdk"
      ],
      "matchFileNames": [
        "devcontainers/**"
      ],
      "minimumReleaseAge": "1 days",
      "automerge": true,
      "automergeType": "branch"
    }
  ],
  "customManagers": [
    {
      "description": "The .NET SDK default version when building the .NET dev container in case no version is provided (e.g. not within a GitHub Action or forgotten to set the environment variable)",
      "customType": "regex",
      "fileMatch": [
        "\\S*\\/devcontainer\\.json"
      ],
      "matchStrings": [
        "\\s*\"dotnet_sdk_version\":\\s*\"(?<currentValue>\\d+\\.\\d+\\.\\d+)\"", // for .devcontainer/devcontainer.json
        "\\s*\"version\":\\s*\"\\${localEnv:DOTNET_SDK_VERSION:(?<currentValue>\\d+\\.\\d+\\.\\d+)}\"", // for devcontainers/dotnet/devcontainer.json
        "\\s*\"DOTNET_SDK_VERSION\":\\s*\"\\${localEnv:DOTNET_SDK_VERSION:(?<currentValue>\\d+\\.\\d+\\.\\d+)}\"" // for devcontainers/dotnet-playwright/devcontainer.json
      ],
      "datasourceTemplate": "dotnet-version",
      "packageNameTemplate": "dotnet-sdk"
    },
    {
      "description": "The .NET SDK default for regular (i.e. not manually triggered) GitHub Action runs â†’ see https://github.com/renovatebot/renovate/discussions/40905",
      "customType": "regex",
      "fileMatch": [
        "\\.github\\/workflows\\/_internal-build-devcontainers\\.yml"
      ],
      "matchStrings": [
        "\\s*DEFAULT_dotnet-sdk-version:\\s*(?<currentValue>\\d+\\.\\d+\\.\\d+)\\S*"
      ],
      "datasourceTemplate": "dotnet-version",
      "packageNameTemplate": "dotnet-sdk"
    }
  ]
}
